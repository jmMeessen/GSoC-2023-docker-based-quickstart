services:
  jenkins:
    build: ../docker-image/
    restart: unless-stopped
    volumes:
      # Mount JCasc files in a directory pointed by the env var "$CASC_JENKINS_CONFIG"
      - ./jcasc.d:/var/jenkins_home/casc.d:ro
      # Mounting the ssh private key as "container secret" makes it available in JCasc as the variable ${SSH_AGENT_KEY}
      - ./secrets/id_jenkins.pem:/run/secrets/SSH_AGENT_KEY:ro
    environment:
      - "CASC_JENKINS_CONFIG=/var/jenkins_home/casc.d/"
      - "JENKINS_EXT_URL=http://localhost:8080/" # Tune this if you use another external hostname
    ports:
      - 8080:8080 # WebUI
  jenkins-agent:
    image: jenkins/ssh-agent:jdk11
    environment:
      # This is a public key. The associated private key must be mounted in the Jenkins controller container.
      - "JENKINS_AGENT_SSH_PUBKEY=ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCdOjSTBkVmgGIKltNupICfjvotAS91AwycdYnXsTfHey/tMD4spqwBgtF18sVpTJ9JTCjdeKgusIHQqaU3cvzrglX900IcJRpEJCyqS/lg/hwYSVboZzuMELhDMkvhdFraXpk8yRsUMUkj+8KdmSPWR6/DzKBzqfkHMPeGNPUy3y13NVStpnhy4XoJRnIX8Etcend85IeO2uMnHseq2YQxm9vMYIguosxgQsv7ebivmFy/lfD3pQ1Ua3QmPINdZ6A0wGKh5VxTnqZCMSDCPNxr2LqRqX8FTPwWIKqUskeNHH0aBIsAFu8r4o+ygR72WGUUN3YFgSZRz3to1POhoqW58FAEQUFm9Ic4PQ8vEDdmrWKWuNL9z7/c8dqCUwDIAnc6JfVYepgfr9bs57jWEM5/tz3GOU3Wnw+uteyc5pksU8XOGZvFA0zmwMC4ZJtOa7kq5OSHfvNpZ8B01GNi013qnWm20Z8mApXknYQ72uJkHjB3JaAsQeJlc8GVMvaKHEkz4j0Rjzk5WdXbWPUZBCPu7LVbqvzLMue8UQovfX1LW2ZiQqMMIEum1IzUFzRDmOsLJ0b+Kc0mGgSYuK2AplDIKHkgM5Ht42oMkvjBHHtCcPdh/7pnsKNDNJbYq9Vr454V8a1YsSnXU6THvfXWh864b/YPfKxCokZ055nIyTssHQ== demo@jenkins.io"
